(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{forum:()=>M});const e=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/app"];var r=t.n(n);const a=flarum.core.compat["forum/components/HeaderSecondary"];var i=t.n(a);const c=flarum.core.compat["forum/ForumApplication"];var s=t.n(c);const u=flarum.core.compat["forum/components/LogInModal"];var l=t.n(u);const p=flarum.core.compat["common/components/LinkButton"];var f=t.n(p);function d(t,o){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},d(t,o)}function g(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,d(t,o)}const h=flarum.core.compat["common/components/Page"];var y=t.n(h);const S=flarum.core.compat["common/utils/extractText"];var v=t.n(S);const b=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/AbstractShopLayout"];var U=t.n(b);function k(){return k=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},k.apply(this,arguments)}const O=flarum.core.compat["common/Component"];var P=t.n(O);const w=flarum.core.compat["forum/components/SignUpModal"];var _=t.n(w);const j=flarum.core.compat["forum/components/LogInButtons"];var L=t.n(j),x=function(t){function o(){for(var o,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(o=t.call.apply(t,[this].concat(n))||this).modalState=new(_()),o}g(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o);var e=k({},o,{attrs:m.route.param().social&&r().flamarktSignUpSocialPayload?r().flamarktSignUpSocialPayload:{}});this.modalState.oninit(e),r().session.user&&this.redirectAfterLogin()},e.oncreate=function(o){t.prototype.oncreate.call(this,o),this.modalState.attrs.username&&!this.modalState.attrs.email?this.$("[name=email]").select():this.$("[name=username]").select()},e.view=function(){return m("form.SignUpForm",{method:"POST",onsubmit:this.onsubmit.bind(this)},[m(".SignUpForm-social",this.modalState.attrs.token?m("p",r().translator.trans("flamarkt-signup-page.forum.complete-social-login")):L().component()),m(".SignUpForm-fields",this.modalState.fields().toArray()),m(".SignUpForm-footer",this.modalState.footer())])},e.onsubmit=function(t){var o=this;t.preventDefault(),this.modalState.loading=!0;var e=this.modalState.submitData();r().request({url:r().forum.attribute("baseUrl")+"/register",method:"POST",body:e}).then((function(){o.redirectAfterLogin()}),this.modalState.loaded.bind(this.modalState))},e.redirectAfterLogin=function(){var t=m.route.param();if(!t.redirect||r().forum.attribute("flamarktSignUpForceRedirect")){var o=r().forum.attribute("flamarktSignUpRedirect");window.location.href=o||"/"}else{var e=new URL(t.redirect,window.location.href);window.location.href=e.pathname}},o}(P()),F=U();F||(F=function(){});var A=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.className=function(){return"SignUpPage"},e.title=function(){return r().translator.trans("core.forum.sign_up.title")},e.content=function(){return x.component()},o}(F),T=function(t){function o(){return t.apply(this,arguments)||this}g(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),r().setTitle(v()(r().translator.trans("core.forum.sign_up.title"))),r().setTitleCount(0)},e.view=function(){return flarum.extensions["flamarkt-core"]?A.component():m(".container.StandaloneSignUpPage",x.component())},o}(y()),M={"components/SignUpForm":x,"layouts/SignUpLayout":A,"pages/SignUpPage":T};r().initializers.add("flamarkt-signup-page",(function(){r().routes["flamarkt.signup"]={path:"/signup",component:T},(0,e.extend)(i().prototype,"items",(function(t){t.has("signUp")&&t.setContent("signUp",f().component({className:"Button Button--link",href:r().route("flamarkt.signup")},r().translator.trans("core.forum.header.sign_up_link")))})),(0,e.extend)(l().prototype,"signUp",(function(){var t={};if(!r().forum.attribute("flamarktSignUpForceRedirect")){var o=m.route.param();t.redirect=o.redirect||m.route.get()}m.route.set(r().route("flamarkt.signup"),t)})),(0,e.override)(s().prototype,"authenticationComplete",(function(t,o){o.loggedIn?t(o):(r().flamarktSignUpSocialPayload=o,m.route.set(r().route("flamarkt.signup"),{social:"1"},{state:{key:Date.now()}}))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map