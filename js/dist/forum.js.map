{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@flamarkt/signup-page/webpack/bootstrap","webpack://@flamarkt/signup-page/webpack/runtime/compat get default export","webpack://@flamarkt/signup-page/webpack/runtime/define property getters","webpack://@flamarkt/signup-page/webpack/runtime/hasOwnProperty shorthand","webpack://@flamarkt/signup-page/webpack/runtime/make namespace object","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['common/extend']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/app']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/components/HeaderSecondary']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/ForumApplication']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@flamarkt/signup-page/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@flamarkt/signup-page/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['common/components/Page']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@flamarkt/signup-page/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/AbstractShopLayout']\"","webpack://@flamarkt/signup-page/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['common/Component']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/components/SignUpModal']\"","webpack://@flamarkt/signup-page/external root \"flarum.core.compat['forum/components/LogInButtons']\"","webpack://@flamarkt/signup-page/./src/forum/components/SignUpForm.ts","webpack://@flamarkt/signup-page/./src/forum/layouts/SignUpLayout.ts","webpack://@flamarkt/signup-page/./src/forum/pages/SignUpPage.ts","webpack://@flamarkt/signup-page/./src/forum/compat.ts","webpack://@flamarkt/signup-page/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/ForumApplication'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/AbstractShopLayout'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SignUpModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButtons'];","import {Vnode, VnodeDOM} from 'mithril';\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\nimport LogInButtons from 'flarum/forum/components/LogInButtons';\n\nexport default class SignUpForm extends Component {\n    modalState: SignUpModal = new SignUpModal;\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        const params = m.route.param();\n\n        // We copy the parent vnode so we have something valid to pass to the modal oninit\n        // The other properties of the vnode probably don't matter because no other lifecycle method is ever called with it\n        const modalVnode: Vnode = {\n            ...vnode,\n            attrs: params.social && app.flamarktSignUpSocialPayload ? app.flamarktSignUpSocialPayload : {},\n        };\n\n        this.modalState.oninit(modalVnode);\n\n        if (app.session.user) {\n            this.redirectAfterLogin();\n        }\n    }\n\n    oncreate(vnode: VnodeDOM) {\n        super.oncreate(vnode);\n\n        if (this.modalState.attrs.username && !this.modalState.attrs.email) {\n            this.$('[name=email]').select();\n        } else {\n            this.$('[name=username]').select();\n        }\n    }\n\n    view() {\n        return m('form.SignUpForm', {\n            method: 'POST', // This prevents the password from ending up in the URL in case onsubmit doesn't work\n            onsubmit: this.onsubmit.bind(this),\n        }, [\n            m('.SignUpForm-social', this.modalState.attrs.token ? m('p', app.translator.trans('flamarkt-signup-page.forum.complete-social-login')) : LogInButtons.component()),\n            m('.SignUpForm-fields', this.modalState.fields().toArray()),\n            m('.SignUpForm-footer', this.modalState.footer()),\n        ]);\n    }\n\n    onsubmit(event: Event) {\n        event.preventDefault();\n\n        this.modalState.loading = true;\n\n        const body = this.modalState.submitData();\n\n        app.request({\n            url: app.forum.attribute('baseUrl') + '/register',\n            method: 'POST',\n            body,\n        }).then(() => {\n            this.redirectAfterLogin();\n        }, this.modalState.loaded.bind(this.modalState));\n    }\n\n    redirectAfterLogin() {\n        const params = m.route.param();\n\n        if (params.redirect && !app.forum.attribute('flamarktSignUpForceRedirect')) {\n            const url = new URL(params.redirect, window.location.href);\n\n            // Only redirect internal URLs for now\n            // If an external URL is passed only the path will be kept and used as internal path\n            window.location.href = url.pathname;\n            return;\n        }\n\n        const redirect = app.forum.attribute<string>('flamarktSignUpRedirect');\n\n        if (redirect) {\n            window.location.href = redirect;\n            return;\n        }\n\n        window.location.href = '/';\n    }\n}\n","import app from 'flarum/forum/app';\nimport AbstractShopLayout from 'flamarkt/core/forum/layouts/AbstractShopLayout';\nimport SignUpForm from '../components/SignUpForm';\n\nlet AbstractLayout = AbstractShopLayout\n\n// If Flamarkt isn't installed, this class won't be used\n// We'll just extend a generic class to prevent any error\nif (!AbstractLayout) {\n    AbstractLayout = class {\n    };\n}\n\nexport default class SignUpLayout extends AbstractLayout {\n    className(): string {\n        return 'SignUpPage';\n    }\n\n    title() {\n        return app.translator.trans('core.forum.sign_up.title');\n    }\n\n    content() {\n        return SignUpForm.component();\n    }\n}\n","import {Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport Page from 'flarum/common/components/Page';\nimport extractText from 'flarum/common/utils/extractText';\nimport SignUpLayout from '../layouts/SignUpLayout';\nimport SignUpForm from '../components/SignUpForm';\n\nexport default class SignUpPage extends Page {\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        app.setTitle(extractText(app.translator.trans('core.forum.sign_up.title')));\n        app.setTitleCount(0);\n    }\n\n    view() {\n        return flarum.extensions['flamarkt-core'] ? SignUpLayout.component() : m('.container.StandaloneSignUpPage', SignUpForm.component());\n    }\n}\n","import SignUpForm from './components/SignUpForm';\nimport SignUpLayout from './layouts/SignUpLayout';\nimport SignUpPage from './pages/SignUpPage';\n\nexport const forum = {\n    'components/SignUpForm': SignUpForm,\n    'layouts/SignUpLayout': SignUpLayout,\n    'pages/SignUpPage': SignUpPage,\n};\n","import {extend, override} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\nimport ForumApplication from 'flarum/forum/ForumApplication';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport SignUpPage from './pages/SignUpPage';\nimport {forum} from './compat';\n\nexport {forum};\n\napp.initializers.add('flamarkt-signup-page', () => {\n    app.routes['flamarkt.signup'] = {\n        path: '/signup',\n        component: SignUpPage,\n    };\n\n    extend(HeaderSecondary.prototype, 'items', function (items) {\n        if (items.has('signUp')) {\n            items.setContent('signUp', LinkButton.component({\n                className: 'Button Button--link',\n                href: app.route('flamarkt.signup'),\n            }, app.translator.trans('core.forum.header.sign_up_link')));\n        }\n    });\n\n    extend(LogInModal.prototype, 'signUp', function () {\n        const data: any = {};\n\n        // We don't add the current URL to the redirect parameter if we know it's going to be ignored anyway\n        if (!app.forum.attribute('flamarktSignUpForceRedirect')) {\n            const params = m.route.param();\n\n            data.redirect = params.redirect || m.route.get();\n        }\n\n        m.route.set(app.route('flamarkt.signup'), data);\n    });\n\n    override(ForumApplication.prototype, 'authenticationComplete', function (original: any, payload: any) {\n        if (payload.loggedIn) {\n            original(payload);\n        } else {\n            // We store the social payload in a global variable\n            // We could pass it via the URL but it wouldn't very pretty and the user might think they could edit it\n            app.flamarktSignUpSocialPayload = payload;\n\n            m.route.set(app.route('flamarkt.signup'), {\n                social: '1',\n            }, {\n                state: {\n                    key: Date.now(), // Force re-creating the signup page if we were already on it\n                },\n            });\n        }\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","extensions","_extends","assign","target","i","arguments","length","source","apply","this","SignUpForm","modalState","SignUpModal","oninit","vnode","modalVnode","attrs","m","route","param","social","app","redirectAfterLogin","oncreate","username","email","$","select","view","method","onsubmit","token","LogInButtons","fields","toArray","footer","event","preventDefault","loading","body","submitData","url","then","loaded","params","redirect","window","location","href","URL","pathname","Component","AbstractLayout","AbstractShopLayout","SignUpLayout","className","title","content","component","SignUpPage","extractText","Page","forum","path","extend","HeaderSecondary","items","has","setContent","LinkButton","LogInModal","data","set","override","ForumApplication","original","payload","loggedIn","state","Date","now"],"sourceRoot":""}